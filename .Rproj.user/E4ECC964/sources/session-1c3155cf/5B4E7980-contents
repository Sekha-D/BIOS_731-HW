---
title: "BIOS761/EPI760 Homework 2"
author: "David Benkeser"
output: 
  pdf_document:
    extra_dependencies: ["booktabs", "float"]
    keep_tex: false
    highlight: haddock
urlcolor: blue    
---

__Instructions__: Write answers in complete sentences where appropriate.

Consider the example we discussed in class where:

- $W$ = receipt of chemotherapy
- $A$ = receipt of radiation therapy
- $V$ = late stage diagnosis
- $Y(a)$ = counterfactual survival time from diagnosis under assignment to radition therapy level $a$ (0 or 1)
- $Y(a,w)$ = counterfactual survival time from diagnosis under assignment to radition therapy level $a$ (0 or 1) and chemotherapy level $w$ (0 or 1)

1. (1 pt) What result allows you to write \begin{equation} \label{eqn:marginal_Yaw}
E[Y(a,w)] = \sum_{v} E[Y(a,w) \mid V = v] P(V = v) \ ?
\end{equation} 
Provide a real-world interpretation of each side of this equation.

2. (1 pt) Define $E[Y(a) \mid W = w]$ in real world terms and explain what it means for there to be treatment effect heterogeneity in this example.

3. (1 pt) It turns out that under assumptions (see bonus question below) \begin{equation} \label{eqn:conditional_Ya}
  E[Y(a) \mid W = w] = \sum_{v} E[Y(a,w) \mid V = v] P(V = v \mid W = w) \ .
\end{equation}
Compare the right hand sides of equations (\ref{eqn:marginal_Yaw}) and (\ref{eqn:conditional_Ya}). What is different between the equations?

4. (1 pt) Suppose the joint distribution of ($W, V$) is shown below:

\begin{table}[H]
\centering
\begin{tabular}{c|cc}
\toprule
      & $V=0$ & $V=1$ \\
\midrule
$W=0$ &  3/8  &  1/8  \\
$W=1$ &  1/8  &  3/8  \\
\bottomrule
\end{tabular}
\end{table}

That is $P(W = 0, V = 0) = 3/8$, $P(W = 0, V = 1) = 1/8$, etc... Fill in the following table.

\begin{table}[H]
\centering
\begin{tabular}{cc|cc}
\toprule
$v$  & $w$ & $P(V = v)$ & $P(V = v \mid W = w)$\\
\midrule
 0   &  0  &            &                     \\
 0   &  1  &            &                     \\
 1   &  0  &            &                     \\
 1   &  1  &            &                     \\
\bottomrule
\end{tabular}
\end{table}

5. (1pt) For each $(v,w)$ combination, comment on the weights assigned to subgroups defined by late stage diagnosis ($V$) by both $E[Y(a,w)]$ and $E[Y(a) \mid W = w]$. How do they compare? What does this imply about the relative weight given to subgroups of $V$ when calculating $E[Y(a,w)]$ and $E[Y(a) \mid W = w]$?

6. (1pt) Characterize the ratio of the weights $P(V = v \mid W = w)/P(V = v)$ in terms of probabilities $P(W = w)$ and $P(W = w \mid V = v)$. (*Hint: use Bayes Theorem*).

\vspace{1em}

Recall that we will say that treatment effect heterogeneity is present on the *additive scale* if $E[Y(1) - Y(0) \mid W = w]$ changes with $w$. We say that there is a causal interaction on the *additive scale* if $E[Y(1,1) - Y(0,0)] \ne E[Y(1,0) - Y(0,0)] + E[Y(0,1) - Y(0,0)]$. 

Similarly, we say that treatment effect heterogeneity is present on the *multiplicative scale* if $E[Y(1) \mid W = w]/E[Y(0) \mid W = w]$ changes with $w$ and that there is a causal interaction on the *multiplicative scale* if $E[Y(1,1)]/E[Y(0,0)] \ne E[Y(1,0)]/E[Y(0,0)] \times E[Y(0,1)]/E[Y(0,0)]$.

For question 7-15 below, a functional form is shown for $E[Y(a,w) \mid V = v]$. Use this form with (\ref{eqn:marginal_Yaw}), (\ref{eqn:conditional_Ya}), and the table from question 4 to write down the value of $E[Y(a) \mid W = w]$ and $E[Y(a, w)]$ for all combinations of $(a,w)$. Then use these values to determine whether treatment effect heterogeneity and/or causal interaction are present on the additive scale and/or multiplicative scale.

\vspace{1em}

7. (1pt) $E[Y(a,w) \mid V = v] = 2 + a + w - v$

8. (1pt) $E[Y(a,w) \mid V = v] = 2 + a + w + wa - v$

9. (1pt) $E[Y(a,w) \mid V = v] = 2 + a - v + av$

10. (1pt) $E[Y(a,w) \mid V = v] = 2 + a + w - v + awv$

11. (1pt) $E[Y(a,w) \mid V = v] = \mbox{exp}(2 + a + w - v)$

12. (1pt) $E[Y(a,w) \mid V = v] = \mbox{exp}(2 + a + w + wa - v)$

13. (1pt) $E[Y(a,w) \mid V = v] = \mbox{exp}(2 + a - v + av)$

14. (1pt) $E[Y(a,w) \mid V = v] = \mbox{exp}(2 + a + w - v + awv)$

15. (6pt) Reflect on your findings in question 7-14. Are there settings where interaction is present but effect heterogeneity is not or vice versa? Does the scale of the effect measure affect your conclusions? If so, how?

16. (BONUS 0pt) Prove (\ref{eqn:conditional_Ya}) assuming \begin{enumerate}
\item[(A1)] {\it Causal consistency}: for any individual $i$ in the population with $W_i = w$, we have that $Y_i(a) = Y_i(a,w)$. The assumption states that any individual in the population observed to "naturally" undergo chemotherapy has the same potential outcome as if they had been assigned to chemotherapy by our hypothetical intervention.
\item[(A2)] {\it Independence/no unmeasured confounding}: $Y(a,w) \perp W \mid V$. The assumption states that $V$ contains all confounders (or is sufficient to block all backdoor paths between $Y$ and $W$ in a DAG).
\end{enumerate}

